<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>תובנות וצירופים נוספים — LottoGun</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; direction: rtl; }
    .container { max-width: 800px; margin: auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }
    .section { background: #fff; border-radius: 10px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .section h2 { margin-top: 0; color: #333; font-size: 1.3em; }
    .combo-list { display: flex; flex-wrap: wrap; gap: 10px; }
    .combo-item { background: linear-gradient(to top, #4CAF50, #81C784); color: #fff; padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 0.95em; }
    .frequency { font-size: 0.8em; display: block; margin-top: 3px; color: #222; background: rgba(255,255,255,0.7); border-radius: 6px; padding: 1px 4px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>תובנות וצירופים נוספים</h1>

    <div class="section">
      <h2>זוגות שחזרו עד 15 פעמים</h2>
      <div class="combo-list" id="pairs"></div>
    </div>

    <div class="section">
      <h2>שלשות שחזרו עד 15 פעמים</h2>
      <div class="combo-list" id="triplets"></div>
    </div>

    <div class="section">
      <h2>רביעיות שחזרו עד 2 פעמים</h2>
      <div class="combo-list" id="quads"></div>
    </div>

    <div class="section">
      <h2>חמישיות שחזרו עד 2 פעמים</h2>
      <div class="combo-list" id="quints"></div>
    </div>
  </div>

  <script>
    (async function(){
      const resp = await fetch('/Lotto.xlsx');
      const arr = await resp.arrayBuffer();
      const wb = XLSX.read(arr, { type: 'array' });
      const ws = wb.Sheets[wb.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(ws, { header:1 });

      const freq = { pairs:{}, triplets:{}, quads:{}, quints:{} };

      rows.forEach(r => {
        const nums = r.filter(n => typeof n === 'number');
        const len = nums.length;
        for (let i=0; i<len; i++) {
          for (let j=i+1; j<len; j++) {
            const p = [nums[i], nums[j]].sort((a,b)=>a-b).join('-');
            freq.pairs[p] = (freq.pairs[p]||0) + 1;
          }
          for (let j=i+1; j<len; j++) {
            for (let k=j+1; k<len; k++) {
              const t = [nums[i], nums[j], nums[k]].sort((a,b)=>a-b).join('-');
              freq.triplets[t] = (freq.triplets[t]||0) + 1;
            }
            for (let k=j+1; k<len; k++) {
              for (let l=k+1; l<len; l++) {
                const q = [nums[i], nums[j], nums[k], nums[l]].sort((a,b)=>a-b).join('-');
                freq.quads[q] = (freq.quads[q]||0) + 1;
              }
            }
          }
          for (let j=i+1; j<len; j++) {
            for (let k=j+1; k<len; k++) {
              for (let l=k+1; l<len; l++) {
                for (let m=l+1; m<len; m++) {
                  const qu = [nums[i], nums[j], nums[k], nums[l], nums[m]].sort((a,b)=>a-b).join('-');
                  freq.quints[qu] = (freq.quints[qu]||0) + 1;
                }
              }
            }
          }
        }
      });

      const filterAndRender = (dataObj, limit, containerId) => {
        const arr = Object.entries(dataObj).filter(([_,c]) => c <= limit);
        arr.sort((a,b) => b[1] - a[1]);
        const cont = document.getElementById(containerId);
        arr.forEach(([combo, count]) => {
          const div = document.createElement('div');
          div.className = 'combo-item';
          div.innerHTML = `${combo} <span class="frequency">(${count} פעמים)</span>`;
          cont.appendChild(div);
        });
      };

      filterAndRender(freq.pairs, 15, 'pairs');
      filterAndRender(freq.triplets, 15, 'triplets');
      filterAndRender(freq.quads, 2, 'quads');
      filterAndRender(freq.quints, 2, 'quints');
    })();
  </script>
</body>
</html>

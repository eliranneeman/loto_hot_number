<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×¦×™×¨×•×¤×™ ×œ×•×˜×• ××ª×§×“×</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=pub-2154227955978159"
         crossorigin="anonymous"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

	

    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .counters {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .counter {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .counter-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .counter-label {
            color: #4a5568;
            font-size: 0.9em;
        }

        .file-upload {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #f5576c;
            background: #fafafa;
        }

        .file-input {
            display: none;
        }

        .file-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .file-upload-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #download-sample-btn {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            font-weight: bold;
        }

        #download-sample-btn:hover {
            background: linear-gradient(135deg, #00a085 0%, #008f7a 100%);
        }

        .file-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .file-status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .file-status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .history-filter {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .history-filter label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .history-filter input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        label {
            font-weight: bold;
            color: #2d3748;
        }
        
        select, input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        
        .results {
            margin-top: 30px;
        }
        
        .combination {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            margin: 15px 0;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .combination.winner {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border: 3px solid #e17055;
        }

        .combination.new {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .numbers {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .regular {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .strong {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .stats {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stats-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.2em;
        }
        
        .hot-numbers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .hot-category {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .hot-category h4 {
            margin: 0 0 10px 0;
            color: #4a5568;
        }
        
        .hot-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .hot-number {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
        }

        .winner-badge {
            background: #e17055;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }

        .new-badge {
            background: #00b894;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        /* CSS ×œ×× ×™××¦×™×•×ª ×¤×¨×¡×•××•×ª */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        @keyframes slideIn {
            from { 
                transform: scale(0.7) translateY(-50px);
                opacity: 0;
            }
            to { 
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .combination {
                flex-direction: column;
                text-align: center;
            }

            .counters {
                grid-template-columns: 1fr;
            }

            .history-filter {
                flex-direction: column;
                align-items: stretch;
            }
        }

#sidebar {
  position: fixed;
  top: 0;
  right: -500px; /* ××•×¡×ª×¨ ××—×•×¥ ×œ××¡×š */
  width: 400px;
  height: 100%;
  background: #fff;
  border-left: 2px solid #ccc;
  box-shadow: -2px 0 5px rgba(0,0,0,0.2);
  transition: right 0.3s ease;
  overflow-y: auto;
  z-index: 9999;
  padding: 15px;
}
#sidebar.open {
  right: 0; /* × ×›× ×¡ ×œ××¡×š */
}
.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

    </style>
<script type="module">
    // --- ×™×™×‘×•× ×¡×¤×¨×™×•×ª ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getDatabase, ref, runTransaction, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    // --- ×§×•× ×¤×™×’×•×¨×¦×™×” ---
    const firebaseConfig = {
        apiKey: "AIzaSyDewHgup8jkCbRJOKfcE8qJn96lO5ZPo_I",
        authDomain: "loto-hot.firebaseapp.com",
        databaseURL: "https://loto-hot-default-rtdb.firebaseio.com",
        projectId: "loto-hot",
        storageBucket: "loto-hot.firebasestorage.app",
        messagingSenderId: "1078323335501",
        appId: "1:1078323335501:web:77f214ff257f14d17d2704",
        measurementId: "G-FR83RCV8Z8"
    };

    // --- ××ª×—×•×œ Firebase ---
    const app = initializeApp(firebaseConfig);

    // --- ××ª×—×•×œ Realtime Database ---
    const database = getDatabase(app);

    // --- ××ª×—×•×œ Firestore ---
    const db = getFirestore(app);

    console.log("âœ… Firebase initialized");
    console.log("âœ… Realtime Database ready:", database);
    console.log("âœ… Firestore ready:", db);

    // --- ×“×•×’××ª ×©×™××•×© ---
    // ×©××™×¨×” ×œ-Firestore
    async function saveCombinationToFirestore(combination) {
        try {
            const docRef = await addDoc(collection(db, "combinations"), {
                combination,
                createdAt: new Date().toISOString(),
                hits: 0,
                hasStrong: false,
                expireAt: null
            });
            console.log("âœ… Saved combination with ID:", docRef.id);
        } catch (error) {
            console.error("âŒ Firestore save error:", error);
        }
    }

    // ×“×•×’××ª ×©×™××•×© ×œ-Realtime Database
    function incrementCounter(counterPath) {
        const counterRef = ref(database, counterPath);
        runTransaction(counterRef, current => (current || 0) + 1);
    }






    // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
    let visitCount = 0;
    let comboCount = 0;
    let lotteryHistory = [];

    // ×××–×™×Ÿ ×‘×–××Ÿ ×××ª ×œ× ×ª×•× ×™× ××”×¤×™×™×¨×‘×™×™×¡
    function listenToCounters() {
        const countersRef = ref(database, 'counters');
        onValue(countersRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                visitCount = data.visits || 0;
                comboCount = data.combos || 0;
                updateCountersDisplay()
            }
        });
    }

    // ××’×“×™×œ ××ª ××•× ×” ×”×‘×™×§×•×¨×™×
    function incrementVisitInFirebase() {
        runTransaction(ref(database, 'counters/visits'), (current) => (current || 0) + 1)
            .catch((error) => console.error("âŒ visit increment error:", error));
    }

    // ××’×“×™×œ ××ª ××•× ×” ×”×¦×™×¨×•×¤×™×
    function incrementComboInFirebase() {
        runTransaction(ref(database, 'counters/combos'), (current) => (current || 0) + 1)
            .catch((error) => console.error("âŒ combo increment error:", error));
    }

    // ××’×“×™×œ ×¦×™×¨×•×¤×™× ×‘×›××•×ª ××¡×•×™××ª
    function incrementCombosInFirebase(count) {
        runTransaction(ref(database, 'counters/combos'), (current) => (current || 0) + count)
            .catch((error) => console.error("âŒ combo increment error:", error));
         return;
    }

    // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×‘××ª×¨
    function updateCountersDisplay() {
        document.getElementById("visitCount").textContent = visitCount;
        document.getElementById("comboCount").textContent = comboCount;
    }

    // ×˜×¢×™× ×ª ×”××ª×¨
    window.addEventListener("DOMContentLoaded", () => {
        listenToCounters();      // ×××–×™×Ÿ ×œ××•× ×™× ×‘×–××Ÿ ×××ª
        incrementVisitInFirebase(); // ×¡×•×¤×¨ ×›× ×™×¡×” ×—×“×©×”
    });
     window.incrementCombosInFirebase = incrementCombosInFirebase;
</script>




	

</head>
<body>
    <div class="container">
        <h1>ğŸ² ××—×•×œ×œ ×¦×™×¨×•×¤×™ ×œ×•×˜×• ××ª×§×“× ğŸ²</h1>
        
        <!-- ××•× ×™× -->
        <div class="counters">
            <div class="counter">
                <div class="counter-number" id="visitCount">0</div>
                <div class="counter-label">×‘×™×§×•×¨×™× ×‘××ª×¨</div>
            </div>
            <div class="counter">
                <div class="counter-number" id="comboCount">0</div>
                <div class="counter-label">×¦×™×¨×•×¤×™× ×©× ×•×¦×¨×•</div>
            </div>
            <div class="counter">
                <div class="counter-number" id="history-counter">0</div>
                <div class="counter-label">×”×’×¨×œ×•×ª ×‘×”×™×¡×˜×•×¨×™×”</div>
            </div>
        </div>

<!-- ×›×¤×ª×•×¨ ×¤×ª×™×—×” -->
<button class="open-sidebar" onclick="toggleSidebar()">ğŸ“‚ ×”×™×¡×˜×•×¨×™×™×ª ×¤×’×™×¢×•×ª</button>

<!-- ×—×œ×•×Ÿ ×¦×“ -->
<div id="sidebar">
  <div class="sidebar-header">
    <h2>ğŸ“Š ×”×™×¡×˜×•×¨×™×™×ª ×¤×’×™×¢×•×ª</h2>
    <button onclick="toggleSidebar()">âŒ ×¡×’×•×¨</button>
  </div>
  <div id="sidebar-content"></div>
</div>

    >
<button class="file-upload-btn" onclick="toggleUploadSection()">ğŸ“‚ ×”×¦×’ / ×”×¡×ª×¨ ××¤×©×¨×•×ª ×”×¢×œ××ª ×§×•×‘×¥</button>

<!-- ××–×•×¨ ×”×”×¢×œ××” (×¡×’×•×¨ ×›×‘×¨×™×¨×ª ××—×“×œ) -->
<div id="upload-section" style="display: none; margin-top: 15px;">

    <div class="stats-title">ğŸ“Š ×”×¢×œ××ª ×§×•×‘×¥ ×ª×•×¦××•×ª ×”×’×¨×œ×•×ª</div>
    
    <!-- ×›×¤×ª×•×¨ ×”×•×¨×“×” -->
    <div style="text-align: center; margin-bottom: 20px;">
        <a href="#" id="download-sample-btn" class="file-upload-btn" onclick="downloadSampleFile()" style="text-decoration: none; display: inline-block;">
          ×”×•×¨×“×ª ×§×•×‘×¥ ×¢× ×ª×•×¦××•×ª ×”×”×’×¨×œ×•×ª ××ª××¨×™×š 28/02/2009
        </a>
        <div style="font-size: 12px; color: #666; margin-top: 5px;">
            ×§×•×‘×¥ Excel ××¢×•×“×›×Ÿ ×¢× ×›×œ ×ª×•×¦××•×ª ×”×œ×•×˜×• ××”×©× ×™× ×”××—×¨×•× ×•×ª × ×˜×¢×Ÿ ××•×˜×•××˜×™×ª ×‘×›× ×™×¡×” ×œ××ª×¨.<br>
            ×‘××™×“×” ×•×™×© ×‘×™×“×›× ×§×•×‘×¥ ××—×¨ ×©×ª×¨×¦×• ×œ×”×¤×™×§ ××× ×• ×¦×™×¨×•×¤×™× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ ××•×ª×• ×›××Ÿ ×¢×œ ×¤×™ ×”×¤×¨××˜×¨×™× ×”×¨×©×•××™× ××˜×”.
        </div>
    </div>
    
    <!-- ××–×•×¨ ×”×¢×œ××” -->
    <div class="file-upload-area" onclick="document.getElementById('excel-file').click()">
        <div>ğŸ“ ×œ×—×¥ ×›××Ÿ ×œ×”×¢×œ××ª ×§×•×‘×¥ Excel ×¢× ×ª×•×¦××•×ª ×”×’×¨×œ×•×ª ×§×•×“××•×ª</div>
        <button type="button" class="file-upload-btn">×‘×—×¨ ×§×•×‘×¥ ××”××—×©×‘</button>
        <div style="font-size: 12px; color: #666; margin-top: 10px;">
            ×§×•×‘×¥ Excel ×¦×¨×™×š ×œ×›×œ×•×œ ×¢××•×“×•×ª: ×ª××¨×™×š, ××¡×¤×¨1, ××¡×¤×¨2, ××¡×¤×¨3, ××¡×¤×¨4, ××¡×¤×¨5, ××¡×¤×¨6, ××¡×¤×¨_×—×–×§
        </div>
    </div>
    <input type="file" id="excel-file" class="file-input" accept=".xlsx,.xls" onchange="handleExcelUpload(event)">
    <div id="file-status" class="file-status"></div>
</div>


        <!-- ××¡× ×Ÿ ×”×™×¡×˜×•×¨×™×” -->
        <div class="history-filter" id="history-filter" style="display: none;">
            <div class="stats-title">ğŸ¯ ×‘×—×™×¨×ª ×¡×•×’ ×¦×™×¨×•×¤×™×:</div>
            <label>
                <input type="checkbox" id="allow-winners" checked>
                ××¤×©×¨ ×¦×™×¨×•×¤×™× ×©×–×›×• ×‘×¢×‘×¨
            </label>
            <label>
                <input type="checkbox" id="allow-new" checked>
                ××¤×©×¨ ×¦×™×¨×•×¤×™× ×—×“×©×™×
             </label>
             <label>
                <input type="checkbox" 
id="no-two-sequences"> ×‘×œ×™ ×¨×¦×¤×™× ×©×œ 2 ××¡×¤×¨×™× ×¢×•×§×‘×™× (×¦×™××¦×•× ×©×œ 61% ××”××¤×©×¨×•×™×•×ª)
            </label>
            <label>
  <input type="checkbox"
id="no-sequences"> ×‘×œ×™ ×¨×¦×¤×™× ×©×œ 3 ××¡×¤×¨×™× ×¢×•×§×‘×™× ×•××¢×œ×” (×¦×™××¦×•× 8.2% ××—×•×– ××›×œ×œ ×”××¤×©×¨×•×™×•×ª)       </label>
        </div>
        
        <div class="stats">
            <div class="stats-title">ğŸ“Š ×”××¡×¤×¨×™× ×”×—××™× ×‘×™×•×ª×¨ (×¢×œ ×¤×™ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª - ××©× ×ª 2005 ×××ª×¨ ××¤×¢×œ ×”×¤×™×¡)</div>
            <div class="hot-numbers">
                <div class="hot-category">
                    <h4>××¡×¤×¨×™× ×¨××©×™×™× ×—××™×:</h4>
                    <div class="hot-list" id="hot-regular-list">
                        </div>
                </div>
                <div class="hot-category">
                    <h4>××¡×¤×¨ ×—×–×§ ×—×:</h4>
                    <div class="hot-list" id="hot-strong-list">
                        </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="strategy">××¡×˜×¨×˜×’×™×”:</label>
                <select id="strategy">
                    <option value="hot">××¡×¤×¨×™× ×—××™× (×”×•×¤×™×¢×• ×”×¨×‘×”)</option>
                    <option value="balanced">×××•×–×Ÿ (×—××™× + ×§×¨×™×)</option>
                    <option value="cold">××¡×¤×¨×™× ×§×¨×™× (×”×•×¤×™×¢×• ××¢×˜)</option>
                    <option value="random">××§×¨××™ ×œ×—×œ×•×˜×™×Ÿ</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="combinations">××¡×¤×¨ ×¦×™×¨×•×¤×™×:</label>
                <select id="combinations">
                    <option value="2" selected>2</option>
                    <option value="4">4</option>
                    <option value="6">6</option>
                    <option value="8">8</option>
                    <option value="10">10<option>
                    <option value="12">12<option>
                    <option value="14">14<option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="hotWeight">××©×§×œ ××¡×¤×¨×™× ×—××™×:</label>
                <input type="range" id="hotWeight" min="0" max="100" value="70">
                <span id="hotWeightValue">70%</span>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button class="generate-btn" onclick="generateNumbers()">ğŸ¯ ×¦×•×¨ ×¦×™×¨×•×¤×™×</button>
        </div>
        
        <div id="results" class="results"></div>
    </div>





<script>




		
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let visitCount = 0;
        let comboCount = 0;
        let lotteryHistory = [];
        let winningCombinations = new Set();

        // ×¤×•× ×§×¦×™×” ×œ×˜×¢×™× ×ª × ×ª×•× ×™× ××”×–×™×›×¨×•×Ÿ
        function loadCounters() {
  			  const db = firebase.database();

    		db.ref("counters/visitCount").on("value", (snapshot) => {
        		document.getElementById("visitCount").innerText = snapshot.val() || 0;
   			 });

    		db.ref("counters/comboCount").on("value", (snapshot) => {
        		document.getElementById("comboCount").innerText = snapshot.val() || 0;
    		});

            
            // ×‘× ×™×™×ª ×¨×©×™××ª ×¦×™×¨×•×¤×™× ×–×•×›×™×
            //buildWinningCombinations();
           
           // updateCountersDisplay();
        }

        // ×¤×•× ×§×¦×™×” ×œ×©××™×¨×ª × ×ª×•× ×™× ×œ×–×™×›×¨×•×Ÿ
        function saveCounters() {
            sessionStorage.setItem('lotto-visits', JSON.stringify(visitCount));
            sessionStorage.setItem('lotto-combos', JSON.stringify(comboCount));
            sessionStorage.setItem('lotto-history', JSON.stringify(lotteryHistory));
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”××•× ×™×
        function updateCountersDisplay() {
            document.getElementById('visitCount').textContent = visitCount.toLocaleString('he-IL');
            document.getElementById('comboCount').textContent = comboCount.toLocaleString('he-IL');
            document.getElementById('history-counter').textContent = lotteryHistory.length.toLocaleString('he-IL');
        }

        // ×¤×•× ×§×¦×™×” ×œ×‘× ×™×™×ª ×¨×©×™××ª ×¦×™×¨×•×¤×™× ×–×•×›×™×
        function buildWinningCombinations() {
            winningCombinations.clear();
            lotteryHistory.forEach(draw => {
                if (draw.numbers && draw.strong) {
                    const combination = [...draw.numbers].sort((a, b) => a - b).join(',') + '|' + draw.strong;
                    winningCombinations.add(combination);
                }
            });
        }

        // ×¤×•× ×§×¦×™×” ×œ×‘×“×™×§×” ×× ×¦×™×¨×•×£ ×–×›×” ×‘×¢×‘×¨
        function isCombinationWinner(regularNumbers, strongNumber) {
            const combination = [...regularNumbers].sort((a, b) => a - b).join(',') + '|' + strongNumber;
            return winningCombinations.has(combination);
        }

        // ×¤×•× ×§×¦×™×” ×œ×”×•×¨×“×ª ×§×•×‘×¥ ×”×“×•×’××”
        function downloadSampleFile() {
            // ×›××Ÿ ×ª×•×›×œ ×œ×”×—×œ×™×£ ××ª ×”×§×™×©×•×¨ ×œ×§×™×©×•×¨ ×”×××™×ª×™ ×©×œ×š ×‘-GitHub
            const githubUrl = 'https://github.com/eliranneeman/loto_hot_number/raw/refs/heads/main/Lotto.xlsx';
            
            // ×™×¦×™×¨×ª ××œ×× ×˜ a ×–×× ×™ ×œ×”×•×¨×“×”
            const link = document.createElement('a');
            link.href = githubUrl;
            link.download = 'lottery_results.xlsx';
            link.target = '_blank';
            
            // ×”×¦×’×ª ×”×•×“×¢×” ×œ××©×ª××©
            const status = document.getElementById('file-status');
            status.style.display = 'block';
            status.className = 'file-status';
            status.innerHTML = 'ğŸ”„ ××¤× ×” ×œ×”×•×¨×“×ª ×”×§×•×‘×¥ ×-GitHub...';
            
            // × ×™×¡×™×•×Ÿ ×œ×¤×ª×•×— ××ª ×”×§×™×©×•×¨
            try {
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    status.className = 'file-status success';
                    status.innerHTML = 'âœ… ×”×§×™×©×•×¨ × ×¤×ª×—! ×× ×”×”×•×¨×“×” ×œ× ×”×—×œ×”, × ×¡×” ×©×•×‘ ××• ×¤× ×” ×™×©×™×¨×•×ª ×œ×§×™×©×•×¨ GitHub.';
                }, 1000);
                
            } catch (error) {
                status.className = 'file-status error';
                status.innerHTML = `âŒ ×©×’×™××” ×‘×¤×ª×™×—×ª ×”×§×™×©×•×¨. × ×¡×” ×œ×’×©×ª ×™×©×™×¨×•×ª: <a href="${githubUrl}" target="_blank" style="color: #721c24;">×œ×—×¥ ×›××Ÿ</a>`;
            }
        }

        // ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘×”×¢×œ××ª ×§×•×‘×¥ Excel
        function handleExcelUpload(event) {
            const file = event.target.files[0];
            const status = document.getElementById('file-status');
            
            if (!file) return;
            
            status.style.display = 'block';
            status.className = 'file-status';
            status.textContent = '×˜×•×¢×Ÿ ×§×•×‘×¥...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    processLotteryData(jsonData);
                    
                    status.className = 'file-status success';
                    status.textContent = `âœ… ×”×§×•×‘×¥ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! × ×˜×¢× ×• ${lotteryHistory.length} ×”×’×¨×œ×•×ª`;
                    
                     // ×”×•×¡×£ ××ª ×”×©×•×¨×” ×”×–×•:
                    document.getElementById('history-counter').textContent = lotteryHistory.length;
            
                     
                    document.getElementById('history-filter').style.display = 'flex';
                    
                } catch (error) {
                    status.className = 'file-status error';
                    status.textContent = 'âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×‘×¥. ×× × ×•×•×“× ×©×”×§×•×‘×¥ ×‘×¤×•×¨××˜ ×”× ×›×•×Ÿ';
                    console.error('Error processing Excel file:', error);
                }
            };
            
            reader.readAsBinaryString(file);
        }

        // ×¤×•× ×§×¦×™×” ×œ×¢×™×‘×•×“ × ×ª×•× ×™ ×”×”×’×¨×œ×•×ª
        function processLotteryData(data) {
            lotteryHistory = [];
            
            data.forEach(row => {
                try {
                    // × ×™×¡×™×•×Ÿ ×œ×–×”×•×ª ×¢××•×“×•×ª ×‘××•×¤×Ÿ ××•×˜×•××˜×™
                    const keys = Object.keys(row);
                    const dateKey = keys.find(k => k.includes('×ª××¨×™×š') || k.toLowerCase().includes('date'));
                    const strongKey = keys.find(k => k.includes('×—×–×§') || k.toLowerCase().includes('strong'));
                    
                    // ××¦×™××ª ×¢××•×“×•×ª ×”××¡×¤×¨×™×
                    const numberKeys = keys.filter(k => 
                        k.includes('××¡×¤×¨') || 
                        /^[1-6]$/.test(k) || 
                        k.toLowerCase().includes('number')
                    ).slice(0, 6);
                    
                    if (numberKeys.length >= 6 && strongKey) {
                        const numbers = numberKeys.map(k => parseInt(row[k])).filter(n => !isNaN(n) && n >= 1 && n <= 37);
                        const strong = parseInt(row[strongKey]);
                        
                        if (numbers.length === 6 && strong >= 1 && strong <= 8) {
                            lotteryHistory.push({
                                date: row[dateKey] || '×œ× ×™×“×•×¢',
                                numbers: numbers,
                                strong: strong
                            });
                        }
                    }
                } catch (error) {
                    console.warn('Error processing row:', row, error);
                }
            });
            
            buildWinningCombinations();
            
            
        }

        // ×¤×•× ×§×¦×™×” ×œ×”×¦×’×ª ×¤×¨×¡×•××ª ××¡×š ××œ×
        function showInterstitialAd() {
            try {
                const overlay = document.createElement('div');
                overlay.id = 'interstitial-overlay';
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    animation: fadeIn 0.3s ease-in-out;
                `;

                const adContainer = document.createElement('div');
                adContainer.style.cssText = `
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    max-width: 90%;
                    max-height: 80%;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    position: relative;
                    animation: slideIn 0.3s ease-out;
                    text-align: center;
                `;

                adContainer.innerHTML = `
                    <h3 style="color: #333; margin-top: 0;">ğŸ¯ ×¤×¨×¡×•××ª</h3>
                    <div style="background: #f0f0f0; padding: 40px 20px; border-radius: 10px; margin: 20px 0;">
                        <p style="color: #666; font-size: 16px;">×›××Ÿ ×ª×•×¤×™×¢ ×”×¤×¨×¡×•××ª ×©×œ×š</p>
                        <p style="color: #999; font-size: 14px;">×”×•×¡×£ ××ª ×§×•×“ AdSense ×©×œ×š</p>
                    </div>
                    <p style="color: #888; font-size: 12px;">×”×¤×¨×¡×•××ª ×ª×™×¡×’×¨ ××•×˜×•××˜×™×ª ×‘×¢×•×“ 5 ×©× ×™×•×ª</p>
                `;

                const closeButton = document.createElement('button');
                closeButton.innerHTML = 'âœ•';
                closeButton.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 15px;
                    background: #ff4757;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 35px;
                    height: 35px;
                    font-size: 18px;
                    cursor: pointer;
                    font-weight: bold;
                    transition: all 0.2s ease;
                    z-index: 10001;
                `;

                closeButton.onmouseover = () => {
                    closeButton.style.background = '#ff3838';
                    closeButton.style.transform = 'scale(1.1)';
                };

                closeButton.onmouseout = () => {
                    closeButton.style.background = '#ff4757';
                    closeButton.style.transform = 'scale(1)';
                };

                const closeAd = () => {
                    overlay.style.animation = 'fadeOut 0.3s ease-in-out';
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            document.body.removeChild(overlay);
                        }
                    }, 300);
                };

                closeButton.onclick = closeAd;
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        closeAd();
                    }
                };

                adContainer.appendChild(closeButton);
                overlay.appendChild(adContainer);
                document.body.appendChild(overlay);

                setTimeout(() => {
                    if (document.getElementById('interstitial-overlay')) {
                        closeAd();
                    }
                }, 5000);

            } catch (error) {
                console.log('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×¨×¡×•××ª:', error);
            }
        }

        // × ×ª×•× ×™ ×”×¡×˜×˜×™×¡×˜×™×§×•×ª
        const regularStats = {
    1: 390, 2: 364, 3: 386, 4: 345, 5: 355, 6: 377, 7: 354, 8: 381,
    9: 359, 10: 381, 11: 409, 12: 394, 13: 361, 14: 338, 15: 355,
    16: 348, 17: 370, 18: 348, 19: 344, 20: 374, 21: 395, 22: 365,
    23: 359, 24: 368, 25: 391, 26: 385, 27: 375, 28: 381, 29: 386,
    30: 371, 31: 357, 32: 347, 33: 366, 34: 373, 35: 317, 36: 280, 37: 297
};

const strongStats = {
    1: 264, 2: 254, 3: 268, 4: 245, 5: 260, 6: 265, 7: 250, 8: 22
};
        
        // ××¡×¤×¨×™× ××¡×•×“×¨×™× ×œ×¤×™ ×ª×“×™×¨×•×ª
        const hotRegular = Object.entries(regularStats)
            .sort((a, b) => b[1] - a[1])
            .map(([num]) => parseInt(num));
        
        const coldRegular = Object.entries(regularStats)
            .sort((a, b) => a[1] - b[1])
            .map(([num]) => parseInt(num));
        
        const hotStrong = Object.entries(strongStats)
            .sort((a, b) => b[1] - a[1])
            .map(([num]) => parseInt(num));
        
        const coldStrong = Object.entries(strongStats)
            .sort((a, b) => a[1] - b[1])
            .map(([num]) => parseInt(num));
        
        // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ×”××¡×¤×¨×™× ×”×—××™× ×‘×“×£
        function updateHotNumbersDisplay() {
            const hotRegularList = document.getElementById('hot-regular-list');
            hotRegularList.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const num = hotRegular[i];
                const count = regularStats[num];
                const span = document.createElement('span');
                span.className = 'hot-number';
                span.textContent = `${num} (${count})`;
                hotRegularList.appendChild(span);
            }

            const hotStrongList = document.getElementById('hot-strong-list');
            hotStrongList.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const num = hotStrong[i];
                const count = strongStats[num];
                const span = document.createElement('span');
                span.className = 'hot-number';
                span.textContent = `${num} (${count})`;
                hotStrongList.appendChild(span);
            }
        }

        // ×¢×“×›×•×Ÿ ×ª×¦×•×’×ª ××©×§×œ
        document.getElementById('hotWeight').addEventListener('input', function() {
            document.getElementById('hotWeightValue').textContent = this.value + '%';
        });
        
        // ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×¦×™×¨×•×£ ×–×•×›×” ××”×™×¡×˜×•×¨×™×” (×× ×§×™×™×)
        function generateWinningCombination() {
            if (lotteryHistory.length === 0) return null;
            
            const randomDraw = lotteryHistory[Math.floor(Math.random() * lotteryHistory.length)];
            return {
                numbers: [...randomDraw.numbers].sort((a, b) => a - b),
                strong: randomDraw.strong
            };
        }
        function selectUniqueNumbers(sourceArray, count) {
            if (count > sourceArray.length) {
                throw new Error(`Cannot select ${count} unique numbers from array of length ${sourceArray.length}`);
            }
            
            const shuffled = [...sourceArray].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        
  async function generateNumbers() {
    showInterstitialAd();
       
    setTimeout(() => {
        const strategy = document.getElementById('strategy').value;
        const numCombinations = parseInt(document.getElementById('combinations').value);
        const hotWeight = parseInt(document.getElementById('hotWeight').value) / 100;
        const allowWinners = document.getElementById('allow-winners').checked;
        const allowNew = document.getElementById('allow-new').checked;
        
        const results = document.getElementById('results');
        results.innerHTML = '';

        results.innerHTML = '<div style="text-align: center; padding: 20px; font-size: 18px; color: #667eea;">ğŸ² ×™×•×¦×¨ ××ª ×”×¦×™×¨×•×¤×™× ×©×œ×š...</div>';

        setTimeout(() => {
            results.innerHTML = '';
            let generatedCount = 0;
            let attempts = 0;
            const maxAttempts = numCombinations * 10; // ×œ×× ×•×¢ ×œ×•×œ××” ××™× ×¡×•×¤×™×ª

            while (generatedCount < numCombinations && attempts < maxAttempts) {
                attempts++;
                let regularNumbers, strongNumber, isWinner = false;

                // ×× ×”××©×ª××© ×¨×•×¦×” ×¨×§ ×¦×™×¨×•×¤×™× ×–×•×›×™× ×•×™×© ×”×™×¡×˜×•×¨×™×”
                if (allowWinners && !allowNew && lotteryHistory.length > 0) {
                    const winningCombo = generateWinningCombination();
                    if (winningCombo) {
                        regularNumbers = winningCombo.numbers;
                        strongNumber = winningCombo.strong;
                        isWinner = true;
                    } else {
                        continue;
                    }
                } else {
                    // ×™×¦×™×¨×ª ×¦×™×¨×•×£ ×¨×’×™×œ ×œ×¤×™ ×”××¡×˜×¨×˜×’×™×”
                    switch (strategy) {
                        case 'hot':
                            regularNumbers = generateHotNumbers(hotWeight);
                            strongNumber = generateHotStrongNumber(hotWeight);
                            break;
                        case 'balanced':
                            regularNumbers = generateBalancedNumbers();
                            strongNumber = generateBalancedStrongNumber();
                            break;
                        case 'cold':
                            regularNumbers = generateColdNumbers();
                            strongNumber = generateColdStrongNumber();
                            break;
                        default:
                            regularNumbers = generateRandomNumbers();
                            strongNumber = generateRandomStrongNumber();
                    }

                    isWinner = isCombinationWinner(regularNumbers, strongNumber);
                }

const noSequences = document.getElementById('no-sequences').checked;

// ×‘×“×™×§×” ×¢×œ ×”×¦×™×¨×•×£
if (noSequences && hasSequenceOfThree(regularNumbers)) {
    continue; // ×“×™×œ×•×’ ×¢×œ ×”×¦×™×¨×•×£ ×”×–×”
}

const noTwoSequences = document.getElementById('no-two-sequences').checked;

if (noTwoSequences && hasSequenceOfTwo(regularNumbers)) {
    continue; // ×“×™×œ×•×’ ×¢×œ ×”×¦×™×¨×•×£
}


                // ×‘×“×™×§×” ×× ×”×¦×™×¨×•×£ ××ª××™× ×œ×”×¢×“×¤×•×ª ×”××©×ª××©
                const shouldInclude = (isWinner && allowWinners) || (!isWinner && allowNew);

                // ×× ×œ× ×”×•×¢×œ×” ×§×•×‘×¥ ×”×™×¡×˜×•×¨×™×”, ×›×œ ×”×¦×™×¨×•×¤×™× × ×—×©×‘×™× ×—×“×©×™×
                const hasHistory = lotteryHistory.length > 0;

                if (!hasHistory && allowNew) {
    displayCombination(regularNumbers, strongNumber, generatedCount + 1, false);

    try {
        await saveCombinationToFirebase({
            numbers: regularNumbers,
            strong: strongNumber,
            isWinner: false
        });
    } catch (error) {
        console.error("Error saving combination:", error);
    }

    generatedCount++;
} else if (hasHistory && shouldInclude) {
    displayCombination(regularNumbers, strongNumber, generatedCount + 1, isWinner);

    try {
        await saveCombinationToFirebase({
            numbers: regularNumbers,
            strong: strongNumber,
            isWinner: isWinner
        });
    } catch (error) {
        console.error("Error saving combination:", error);
    }

    generatedCount++;
}
}

            if (generatedCount === 0) {
                let errorMessage = '';
                const hasHistory = lotteryHistory.length > 0;

                if (!hasHistory && !allowNew) {
                    errorMessage = 'âš ï¸ ×œ× ×”×•×¢×œ×” ×§×•×‘×¥ ×”×™×¡×˜×•×¨×™×” ×•×œ× × ×‘×—×¨×” ××¤×©×¨×•×ª "×¦×™×¨×•×¤×™× ×—×“×©×™×". ×× × ×”×¢×œ×” ×§×•×‘×¥ Excel ××• ××¤×©×¨ ×¦×™×¨×•×¤×™× ×—×“×©×™×.';
                } else if (hasHistory && !allowWinners && !allowNew) {
                    errorMessage = 'âš ï¸ ×œ× × ×‘×—×¨×” ××£ ××¤×©×¨×•×ª ×œ×™×¦×™×¨×ª ×¦×™×¨×•×¤×™×. ×× × ×‘×—×¨ "×¦×™×¨×•×¤×™× ×©×–×›×• ×‘×¢×‘×¨" ××• "×¦×™×¨×•×¤×™× ×—×“×©×™×".';
                } else if (hasHistory && allowWinners && !allowNew) {
                    errorMessage = `âš ï¸ ×œ× × ××¦××• ××¡×¤×™×§ ×¦×™×¨×•×¤×™× ×–×•×›×™× ×‘×××’×¨ ×”×”×™×¡×˜×•×¨×™×” (${winningCombinations.size} ×¦×™×¨×•×¤×™× ×–×•×›×™× ×–××™× ×™×). × ×¡×” ×œ×”×•×¡×™×£ ×’× ×¦×™×¨×•×¤×™× ×—×“×©×™×.`;
                } else {
                    errorMessage = 'âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×™×¦×•×¨ ×¦×™×¨×•×¤×™× ×¢× ×”×”×’×“×¨×•×ª ×”× ×•×›×—×™×•×ª. × ×¡×” ×œ×©× ×•×ª ××ª ×”×¤×™×œ×˜×¨×™×.';
                }

                results.innerHTML = `<div style="text-align: center; padding: 20px; font-size: 16px; color: #e17055; line-height: 1.5;">${errorMessage}</div>`;
            }
              else{
              incrementCombosInFirebase(generatedCount);
              }
        }, 800);
    }, 500);
          
}

        // ×¤×•× ×§×¦×™×•×ª ××ª×•×§× ×•×ª ×œ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª
        function generateHotNumbers(weight) {
            const hotCount = Math.floor(6 * weight);
            const remainingCount = 6 - hotCount;
            
            let numbers = [];
            
            // ×‘×—×™×¨×ª ××¡×¤×¨×™× ×—××™× (××”×˜×•×¤ 15)
            if (hotCount > 0) {
                const hotPool = hotRegular.slice(0, Math.min(15, hotRegular.length));
                numbers.push(...selectUniqueNumbers(hotPool, Math.min(hotCount, hotPool.length)));
            }
            
            // ×”×©×œ××” ×¢× ××¡×¤×¨×™× ××—×¨×™×
            if (remainingCount > 0) {
                const remainingPool = hotRegular.filter(num => !numbers.includes(num));
                numbers.push(...selectUniqueNumbers(remainingPool, Math.min(remainingCount, remainingPool.length)));
            }
            
            // ×× ×¢×“×™×™×Ÿ ×—×¡×¨×™× ××¡×¤×¨×™× (××§×¨×” ×§×™×¦×•× ×™)
            while (numbers.length < 6) {
                const allNumbers = Array.from({length: 37}, (_, i) => i + 1);
                const available = allNumbers.filter(num => !numbers.includes(num));
                if (available.length > 0) {
                    numbers.push(available[Math.floor(Math.random() * available.length)]);
                }
            }
            
            return numbers.sort((a, b) => a - b);
        }
        
        function generateHotStrongNumber(weight) {
            return Math.random() < weight 
                ? hotStrong[Math.floor(Math.random() * Math.min(3, hotStrong.length))]
                : hotStrong[Math.floor(Math.random() * hotStrong.length)];
        }
        
        function generateBalancedNumbers() {
            let numbers = [];
            
            // 3 ××¡×¤×¨×™× ×—××™× ××”×˜×•×¤ 10
            const hotPool = hotRegular.slice(0, 10);
            numbers.push(...selectUniqueNumbers(hotPool, 3));
            
            // 2 ××¡×¤×¨×™× ×‘×™× ×•× ×™×™×
            const mediumPool = hotRegular.slice(10, 27).filter(num => !numbers.includes(num));
            numbers.push(...selectUniqueNumbers(mediumPool, Math.min(2, mediumPool.length)));
            
            // 1 ××¡×¤×¨ ×§×¨
            const coldPool = hotRegular.slice(27).filter(num => !numbers.includes(num));
            if (coldPool.length > 0 && numbers.length < 6) {
                numbers.push(...selectUniqueNumbers(coldPool, Math.min(1, coldPool.length)));
            }
            
            // ×”×©×œ××” ×‘××™×“×ª ×”×¦×•×¨×š
            while (numbers.length < 6) {
                const allNumbers = Array.from({length: 37}, (_, i) => i + 1);
                const available = allNumbers.filter(num => !numbers.includes(num));
                if (available.length > 0) {
                    numbers.push(available[Math.floor(Math.random() * available.length)]);
                }
            }
            
            return numbers.sort((a, b) => a - b);
        }
        
        function generateBalancedStrongNumber() {
            return hotStrong[Math.floor(Math.random() * hotStrong.length)];
        }
        
        function generateColdNumbers() {
            let numbers = [];
            
            // 4 ××¡×¤×¨×™× ×§×¨×™× ×‘×™×•×ª×¨
            const coldPool = coldRegular.slice(0, 10);
            numbers.push(...selectUniqueNumbers(coldPool, Math.min(4, coldPool.length)));
            
            // 2 ××¡×¤×¨×™× ×—××™× ×œ××™×–×•×Ÿ
            const hotPool = hotRegular.slice(0, 15).filter(num => !numbers.includes(num));
            numbers.push(...selectUniqueNumbers(hotPool, Math.min(2, hotPool.length)));
            
            // ×”×©×œ××” ×‘××™×“×ª ×”×¦×•×¨×š
            while (numbers.length < 6) {
                const allNumbers = Array.from({length: 37}, (_, i) => i + 1);
                const available = allNumbers.filter(num => !numbers.includes(num));
                if (available.length > 0) {
                    numbers.push(available[Math.floor(Math.random() * available.length)]);
                }
            }
            
            return numbers.sort((a, b) => a - b);
        }
        
        function generateColdStrongNumber() {
            return coldStrong[Math.floor(Math.random() * Math.min(3, coldStrong.length))];
        }
        
        function generateRandomNumbers() {
            const allNumbers = Array.from({length: 37}, (_, i) => i + 1);
            return selectUniqueNumbers(allNumbers, 6).sort((a, b) => a - b);
        }
        
        function generateRandomStrongNumber() {
            return Math.floor(Math.random() * 8) + 1;
        }
        
        function displayCombination(regularNumbers, strongNumber, index, isWinner = false) {
            const results = document.getElementById('results');
            
            const combinationDiv = document.createElement('div');
            combinationDiv.className = isWinner ? 'combination winner' : 'combination new';
            
            const numbersDiv = document.createElement('div');
            numbersDiv.className = 'numbers';
            
            // ×ª×¦×•×’×ª ×”××¡×¤×¨×™× ×”×¨×’×™×œ×™×
            regularNumbers.forEach(num => {
                const numberSpan = document.createElement('span');
                numberSpan.className = 'number regular';
                numberSpan.textContent = num;
                numbersDiv.appendChild(numberSpan);
            });
            
            // ×ª×¦×•×’×ª ×”××¡×¤×¨ ×”×—×–×§
            const strongSpan = document.createElement('span');
            strongSpan.className = 'number strong';
            strongSpan.textContent = strongNumber;
            numbersDiv.appendChild(strongSpan);
            
            const infoDiv = document.createElement('div');
            const statusBadge = isWinner ? 
                '<span class="winner-badge">ğŸ† ×–×›×” ×‘×¢×‘×¨</span>' : 
                '<span class="new-badge">ğŸ†• ×¦×™×¨×•×£ ×—×“×©</span>';
            
            infoDiv.innerHTML = `
                ${statusBadge}
                <strong>×¦×™×¨×•×£ ××¡×¤×¨ ${index}</strong><br>
                <small>××¡×¤×¨ ×—×–×§: ${strongNumber}</small><br>
                <small style="color: #666;">âœ“ ×›×œ ×”××¡×¤×¨×™× ×™×™×—×•×“×™×™×</small>
            `;
            
            combinationDiv.appendChild(numbersDiv);
            combinationDiv.appendChild(infoDiv);
            results.appendChild(combinationDiv);
        }
        

function hasSequenceOfThree(numbers) {
    const sorted = [...numbers].sort((a, b) => a - b);
    let count = 1;
    for (let i = 1; i < sorted.length; i++) {
        if (sorted[i] === sorted[i - 1] + 1) {
            count++;
            if (count >= 3) return true;
        } else {
            count = 1;
        }
    }
    return false;
}

function hasSequenceOfTwo(numbers) {
    const sorted = [...numbers].sort((a, b) => a - b);
    for (let i = 1; i < sorted.length; i++) {
        if (sorted[i] === sorted[i - 1] + 1) {
            return true; // × ××¦× ×–×•×’ ×¨×¦×™×£
        }
    }
    return false;
}

     const excelUrl = "https://github.com/eliranneeman/loto_hot_number/raw/refs/heads/main/Lotto.xlsx";
    fetch(excelUrl)
    function loadExcelFromSite() {
    const status = document.getElementById('file-status');
    status.style.display = 'block';
    status.className = 'file-status';
    status.textContent = 'ğŸ”„ ×˜×•×¢×Ÿ ×§×•×‘×¥ ××”××ª×¨...';

    // ×›××Ÿ ×™×© ×œ×”×›× ×™×¡ ××ª ×”××™×§×•× ×”××“×•×™×§ ×©×œ ×”×§×•×‘×¥ ×‘××ª×¨
    const excelPath = 'Lotto.xlsx'; // ×× ×”×§×•×‘×¥ ×‘×ª×™×§×™×™×ª ×”×¨××©×™×ª ×©×œ ×”××ª×¨
    // ×× ×‘×ª×™×§×™×™×” ××—×¨×ª, ×œ××©×œ 'assets/Lotto.xlsx', ×©× ×” ×œ- 'assets/Lotto.xlsx'

    fetch(excelPath)
        .then(res => {
            if (!res.ok) throw new Error('Failed to fetch Excel file');
            return res.arrayBuffer();
        })
        .then(ab => {
            const workbook = XLSX.read(ab, { type: "array" });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            // ×”×¤×•× ×§×¦×™×” ×”×§×™×™××ª ×©×œ×š ×©××¢×‘×“×ª ××ª ×”× ×ª×•× ×™×
            processLotteryData(jsonData);

            status.className = 'file-status success';
            status.textContent = `âœ… ×”×§×•×‘×¥ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”! × ×˜×¢× ×• ${lotteryHistory.length} ×”×’×¨×œ×•×ª`;

            // ×¢×“×›×•×Ÿ ××•× ×” ×”×™×¡×˜×•×¨×™×”
            document.getElementById('history-counter').textContent = lotteryHistory.length;
            document.getElementById('history-filter').style.display = 'flex';
        })
        .catch(error => {
            status.className = 'file-status error';
            status.textContent = 'âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×‘×¥ ×”××•×˜×•××˜×™';
            console.error("Error loading Excel file:", error);
        });
}

//×©××™×¨×ª ×¦×™×¨×•×¤×™× ×œ×¤×™×™×¨×‘×™×™×¡
async function saveCombinationToFirebase(combination) {
    const docRef = await addDoc(collection(db, "combinations"), {
        combination,
        createdAt: new Date().toISOString(),
        hits: 0,
        hasStrong: false,
        expireAt: null
    });
    return docRef.id;
}

//×—×™×©×•×‘ ×¤×’×™×¢×•×ª ×¤×œ×•×¡ ×¢×™×“×›×•×Ÿ ×ª××¨×™×š ×”×¤×’×™×¢×”
async function processHits(lotteryHistory) {
    const q = query(collection(db, "combinations"));
    const snapshot = await getDocs(q);

    snapshot.forEach(async (docSnap) => {
        const c = docSnap.data();
        let maxHits = 0;
        let hasStrong = false;
        let lastExpireAt = null;

        lotteryHistory.forEach((draw, i) => {
            const drawDate = new Date(draw.×ª××¨×™×š);
            const drawNumbers = [draw.××¡×¤×¨1, draw.××¡×¤×¨2, draw.××¡×¤×¨3, draw.××¡×¤×¨4, draw.××¡×¤×¨5, draw.××¡×¤×¨6];
            const strong = draw.××¡×¤×¨_×—×–×§;

            if (new Date(c.createdAt) <= drawDate) {
                const hits = c.combination.filter(num => drawNumbers.includes(num)).length;
                const strongHit = c.combination.includes(strong);

                if (hits >= 3) {
                    maxHits = Math.max(maxHits, hits);
                    hasStrong = strongHit;

                    let expireAt = null;

                    if ((hits === 3 || hits === 4) || (hits === 5 && !strongHit)) {
                        if (i < lotteryHistory.length - 1) {
                            expireAt = new Date(lotteryHistory[i + 1].×ª××¨×™×š);
                        }
                    }

                    if ((hits === 5 && strongHit) || hits === 6) {
                        expireAt = null; // ×œ×ª××™×“
                    }

                    lastExpireAt = expireAt;
                }
            }
        });

        // ×¢×“×›×•×Ÿ ×‘×¤×™×™×¨×‘×™×™×¡
        await updateDoc(doc(db, "combinations", docSnap.id), {
            hits: maxHits,
            hasStrong,
            expireAt: lastExpireAt
        });
    });
}

//×©×œ×™×¤×” ×œ×—×œ×•× ×™×ª ×”×¦×“ ×¨×§ ××” ×©×œ× ×¤×’ ×ª×•×§×£
async function getActiveCombinations() {
    const q = query(collection(db, "combinations"));
    const snapshot = await getDocs(q);

    const now = new Date();
    const active = [];

    snapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (!data.expireAt || new Date(data.expireAt) > now) {
            active.push({ id: docSnap.id, ...data });
        }
    });

    return active;
}


//×ª×¦×•×’×” ×œ×—×œ×•× ×™×ª ×”×¦×“
async function renderSidebar() {
    const sidebarContent = document.getElementById("sidebar-content");
    sidebarContent.innerHTML = "<h3>ğŸ“Œ ×¦×™×¨×•×¤×™× ×¢× ×¤×’×™×¢×•×ª</h3>";

    const combos = await getActiveCombinations();

    combos.forEach(r => {
        sidebarContent.innerHTML += `
            <div class="hit-combination">
              <strong>${r.combination.join(", ")}</strong>
              <span style="color:${r.hits >= 5 ? 'gold' : 'green'};">
                âœ… ${r.hits} ×¤×’×™×¢×•×ª ${r.hasStrong ? '(×›×•×œ×œ ×—×–×§)' : ''}
              </span>
              <div style="font-size:12px; color:#666;">
                × ×•×¦×¨ ×‘: ${new Date(r.createdAt).toLocaleDateString()}  
                ${r.expireAt ? `(×ª×§×£ ×¢×“ ${new Date(r.expireAt).toLocaleDateString()})` : '(× ×©××¨ ×œ×ª××™×“)'}
              </div>
            </div>
        `;
    });
}


//×¤×ª×™×—×ª ×—×œ×•× ×™×ª ×˜×¢×™× ×ª ×”×”×™×¡×˜×•×¨×™×”
function toggleUploadSection() {
    const section = document.getElementById("upload-section");
    section.style.display = section.style.display === "none" ? "block" : "none";
}

//×‘×ª×™×—×ª ×—×œ×•×Ÿ ×¦×“
function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("open");
}


// ××ª×—×•×œ ×”××ª×¨
document.addEventListener('DOMContentLoaded', function() {
    // ×˜×¢×™× ×ª ××•× ×™× ×‘×–××Ÿ ×××ª
   // loadCounters();   // ×××–×™×Ÿ ×œ×©×™× ×•×™×™× ×‘×¤×™×™×¨×‘×™×™×¡
    
    // ×”×¢×œ××ª ××•× ×” ×”×‘×™×§×•×¨×™× ×‘-Firebase
   // incrementVisitInFirebase();
    
    loadExcelFromSite();
    updateHotNumbersDisplay();
    generateNumbers();
});
    </script>
</body>
</html>

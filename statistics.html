<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
        <link rel="stylesheet" href="/common.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2154227955978159"
     crossorigin="anonymous"></script>

<meta name="google-adsense-account" content="ca-pub-2154227955978159">
    
    <title>סטטיסטיקות לוטו - LottoGun</title>
    <style>
/* עיצוב בסיסי משופר עם נגישות מלאה */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    direction: rtl;
    line-height: 1.6;
    font-size: 16px;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    margin-bottom: 30px;
}

.logo {
    color: #ffffff; /* תיקון משחור לחלבן */
    font-size: 2.5em;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* צל חזק יותר */
    margin-bottom: 10px;
    border: 2px solid rgba(255,255,255,0.8);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    padding: 15px 20px;
    border-radius: 15px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
}

.subtitle {
    color: #ffffff; /* תיקון משחור לחלבן */
    font-size: 1.3em;
    font-weight: 600;
    margin-bottom: 20px;
    border: 2px solid rgba(255,255,255,0.8);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    padding: 12px 18px;
    border-radius: 12px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
}

.nav-buttons {
    text-align: center;
    margin-bottom: 30px;
    border: 2px solid rgba(255,255,255,0.6);
    box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    padding: 20px;
    border-radius: 15px;
    background: rgba(255,255,255,0.05);
}

.nav-btn {
    display: inline-block;
    padding: 14px 28px;
    margin: 8px 12px;
    background: rgba(255,255,255,0.25);
    color: #ffffff; /* תיקון משחור לחלבן */
    text-decoration: none;
    border-radius: 25px;
    border: 2px solid rgba(255,255,255,0.6);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    font-weight: bold;
    font-size: 1.1em;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.nav-btn:hover,
.nav-btn:focus {
    background: rgba(255,255,255,0.4);
    transform: translateY(-3px);
    border: 2px solid rgba(255,255,255,0.8);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    outline: none;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.stats-card {
    background: rgba(255,255,255,0.98);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.2);
}

.card-title {
    text-align: center;
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 25px;
    color: #2c3e50;
    border-bottom: 4px solid;
    padding-bottom: 15px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.regular-numbers .card-title {
    border-color: #4CAF50;
    background: linear-gradient(45deg, #4CAF50, #45a049);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.strong-numbers .card-title {
    border-color: #ff6b6b;
    background: linear-gradient(45deg, #ff6b6b, #e55555);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.numbers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.number-item {
    background: white;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    border: 3px solid transparent;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.number-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 35px rgba(0,0,0,0.2);
}

.regular-numbers .number-item {
    border-color: #4CAF50;
}

.strong-numbers .number-item {
    border-color: #ff6b6b;
}

.number-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, #4CAF50, #45a049);
    opacity: 0.9;
}

.strong-numbers .number-item::before {
    background: linear-gradient(90deg, #ff6b6b, #e55555);
}

.number-value {
    font-size: 2.2em;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 10px;
}

.number-count {
    font-size: 1.1em;
    color: #5a6c7d;
    font-weight: 600;
}

.frequency-bar {
    width: 100%;
    height: 10px;
    background: #e8eaf0;
    border-radius: 5px;
    margin: 12px 0;
    overflow: hidden;
    border: 1px solid #ddd;
}

.frequency-fill {
    height: 100%;
    border-radius: 5px;
    transition: width 0.6s ease;
}

.regular-numbers .frequency-fill {
    background: linear-gradient(90deg, #4CAF50, #81C784);
}

.strong-numbers .frequency-fill {
    background: linear-gradient(90deg, #ff6b6b, #ff8a80);
}

.summary-section {
    background: rgba(255,255,255,0.98);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.2);
}

.summary-title {
    text-align: center;
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 25px;
    color: #2c3e50;
    border-bottom: 4px solid #667eea;
    padding-bottom: 15px;
}

.summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 25px;
    text-align: center;
}

.summary-item {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 25px 20px;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s ease;
}

.summary-item:hover {
    transform: translateY(-3px);
}

.summary-value {
    font-size: 2.5em;
    font-weight: bold;
    margin-bottom: 8px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.summary-label {
    font-size: 1.1em;
    opacity: 0.95;
    font-weight: 500;
}

.loading {
    text-align: center;
    color: white;
    font-size: 1.5em;
    font-weight: 600;
    margin: 50px 0;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.hot-label, .cold-label {
    position: absolute;
    top: -8px;
    right: -8px;
    color: white;
    font-size: 0.85em;
    padding: 6px 10px;
    border-radius: 12px;
    font-weight: bold;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

.hot-label {
    background: linear-gradient(135deg, #ff4444, #e63946);
}

.cold-label {
    background: linear-gradient(135deg, #2196F3, #1976D2);
}

.insights-section {
    background: rgba(255,255,255,0.98);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.2);
}

.insights-title {
    text-align: center;
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 25px;
    color: #2c3e50;
    border-bottom: 4px solid #FF9800;
    padding-bottom: 15px;
}

.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.insight-card {
    background: linear-gradient(135deg, #FF9800, #F57C00);
    color: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(255,152,0,0.3);
    transition: transform 0.3s ease;
}

.insight-card:hover {
    transform: translateY(-3px);
}

.insight-type {
    font-size: 1.3em;
    font-weight: bold;
    margin-bottom: 15px;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.combination-item {
    background: rgba(255,255,255,0.25);
    padding: 15px;
    margin: 10px 0;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background 0.3s ease;
}

.combination-item:hover {
    background: rgba(255,255,255,0.35);
}

.combination-numbers {
    font-weight: bold;
    font-size: 1.1em;
}

.combination-count {
    background: rgba(255,255,255,0.4);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: 600;
}

.charts-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
}

.chart-card {
    background: rgba(255,255,255,0.98);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.2);
}

.chart-title {
    text-align: center;
    font-size: 1.5em;
    font-weight: bold;
    margin-bottom: 25px;
    color: #2c3e50;
}

.chart-container {
    width: 100%;
    height: 300px;
    position: relative;
}

.bar-chart {
    display: flex;
    align-items: end;
    justify-content: space-around;
    height: 250px;
    border-bottom: 3px solid #34495e;
    border-left: 3px solid #34495e;
    padding: 20px;
    background: rgba(248, 249, 250, 0.5);
    border-radius: 10px;
}

.chart-bar {
    background: linear-gradient(to top, #4CAF50, #81C784);
    border-radius: 6px 6px 0 0;
    min-width: 25px;
    margin: 0 3px;
    position: relative;
    transition: all 0.3s ease;
    cursor: pointer;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.chart-bar:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
}

.chart-bar-label {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9em;
    font-weight: bold;
    color: #2c3e50;
}

.chart-bar-value {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.9em;
    font-weight: bold;
    color: #2c3e50;
    background: rgba(255,255,255,0.95);
    padding: 4px 8px;
    border-radius: 12px;
    border: 1px solid #ddd;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.chart-bar:hover .chart-bar-value {
    opacity: 1;
}

.pattern-analysis {
    background: rgba(255,255,255,0.98);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.2);
}

.pattern-title {
    text-align: center;
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 25px;
    color: #2c3e50;
    border-bottom: 4px solid #9C27B0;
    padding-bottom: 15px;
}

.pattern-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
}

.pattern-card {
    background: linear-gradient(135deg, #9C27B0, #7B1FA2);
    color: white;
    padding: 25px 20px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(156, 39, 176, 0.3);
    transition: transform 0.3s ease;
}

.pattern-card:hover {
    transform: translateY(-3px);
}

.pattern-value {
    font-size: 2.5em;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.pattern-label {
    font-size: 1.1em;
    opacity: 0.95;
    font-weight: 500;
}

/* ===== מצב ניגודיות גבוהה ===== */
body.high-contrast {
    background: #000 !important;
    color: #fff !important;
}

/* כותרות וטקסטים */
body.high-contrast h1,
body.high-contrast h2,
body.high-contrast h3,
body.high-contrast h4,
body.high-contrast .logo,
body.high-contrast .subtitle,
body.high-contrast .card-title,
body.high-contrast .summary-title,
body.high-contrast .insights-title,
body.high-contrast .pattern-title,
body.high-contrast .chart-title,
body.high-contrast .insight-type {
    color: #fff !important;
    text-shadow: none !important;
    background: none !important;
    -webkit-text-fill-color: #fff !important;
}

/* כפתורי ניווט */
body.high-contrast .nav-btn {
    background: #fff !important;
    color: #000 !important;
    border: 2px solid #fff !important;
    text-shadow: none !important;
}

body.high-contrast .nav-btn:hover,
body.high-contrast .nav-btn:focus {
    background: #ffff00 !important;
    color: #000 !important;
    border-color: #ffff00 !important;
}

/* כרטיסים ותיבות */
body.high-contrast .stats-card,
body.high-contrast .summary-section,
body.high-contrast .insights-section,
body.high-contrast .pattern-analysis,
body.high-contrast .chart-card {
    background: #111 !important;
    border: 2px solid #fff !important;
    color: #fff !important;
}

body.high-contrast .number-item {
    background: #000 !important;
    color: #fff !important;
    border: 2px solid #fff !important;
}

body.high-contrast .number-value,
body.high-contrast .number-count {
    color: #fff !important;
}

/* פסי תדירות */
body.high-contrast .frequency-bar {
    background: #333 !important;
    border: 1px solid #fff !important;
}

body.high-contrast .frequency-fill {
    background: #fff !important;
}

/* כרטיסי סיכום */
body.high-contrast .summary-item {
    background: #fff !important;
    color: #000 !important;
}

body.high-contrast .summary-value,
body.high-contrast .summary-label {
    color: #000 !important;
    text-shadow: none !important;
}

/* כרטיסי תובנות */
body.high-contrast .insight-card {
    background: #fff !important;
    color: #000 !important;
}

body.high-contrast .insight-type {
    color: #000 !important;
}

body.high-contrast .combination-item {
    background: rgba(255,255,255,0.8) !important;
    color: #000 !important;
}

/* כרטיסי דפוסים */
body.high-contrast .pattern-card {
    background: #fff !important;
    color: #000 !important;
}

body.high-contrast .pattern-value,
body.high-contrast .pattern-label {
    color: #000 !important;
    text-shadow: none !important;
}

/* תרשימים */
body.high-contrast .bar-chart {
    background: #111 !important;
    border-color: #fff !important;
}

body.high-contrast .chart-bar {
    background: #fff !important;
    border-color: #fff !important;
}

body.high-contrast .chart-bar-label,
body.high-contrast .chart-bar-value {
    color: #fff !important;
    background: #000 !important;
    border-color: #fff !important;
}

/* תוויות */
body.high-contrast .hot-label,
body.high-contrast .cold-label {
    background: #fff !important;
    color: #000 !important;
}

/* רספונסיביות משופרת */
@media (max-width: 768px) {
    .container {
        padding: 15px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .numbers-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 15px;
    }
    
    .number-item {
        padding: 15px;
    }
    
    .number-value {
        font-size: 1.8em;
    }
    
    .logo {
        font-size: 2em;
        padding: 12px 16px;
    }
    
    .nav-btn {
        display: block;
        margin: 8px auto;
        width: 90%;
        max-width: 300px;
    }
    
    .charts-section {
        grid-template-columns: 1fr;
    }
    
    .insights-grid,
    .pattern-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .logo {
        font-size: 1.8em;
    }
    
    .subtitle {
        font-size: 1.1em;
    }
    
    .card-title,
    .summary-title,
    .insights-title,
    .pattern-title {
        font-size: 1.5em;
    }
    
    .number-value {
        font-size: 1.6em;
    }
    
    .summary-value,
    .pattern-value {
        font-size: 2em;
    }
}

/* נגישות כללית */
*:focus {
    outline: 3px solid #4CAF50;
    outline-offset: 2px;
}

body.high-contrast *:focus {
    outline-color: #ffff00 !important;
}
    </style>
</head>
<body>
      <script src="/common.js" defer></script>
    <div class="container">
        <header>
            <div class="logo">📊 LottoGun</div>
            <div class="subtitle">סטטיסטיקות ומספרים חמים</div>
        </header>
        
        <div class="nav-buttons">
            <a href="index.html" class="nav-btn">🏠 דף הבית</a>
            <a href="results.html" class="nav-btn">📋 תוצאות הגרלות</a>
        </div>
        
        <div id="loadingMessage" class="loading">
            🔄 טוען נתונים וחושב סטטיסטיקות...
        </div>
        
        <div id="statsContent" style="display: none;">
            <div class="summary-section">
                <div class="summary-title">🎯 סיכום כללי</div>
                <div class="summary-stats">
                    <div class="summary-item">
                        <div class="summary-value" id="totalDraws">0</div>
                        <div class="summary-label">סה"כ הגרלות</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="hottestNumber">-</div>
                        <div class="summary-label">המספר הכי חם</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="coldestNumber">-</div>
                        <div class="summary-label">המספר הכי קר</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="hottestStrong">-</div>
                        <div class="summary-label">המספר החזק הכי חם</div>
                    </div>
                </div>
            </div>

            <div class="insights-section">
                <div class="insights-title">🧠 תובנות וצירופים נפוצים</div>
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-type">👥 זוגות נפוצים</div>
                        <div id="popularPairs"></div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-type">🔺 שלשות נפוצות</div>
                        <div id="popularTriples"></div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-type">💎 רביעיות נפוצות</div>
                        <div id="popularQuads"></div>
                    </div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-card">
                    <div class="chart-title">📊 התפלגות מספרים רגילים</div>
                    <div class="chart-container">
                        <div class="bar-chart" id="regularChart"></div>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">💪 התפלגות מספרים חזקים</div>
                    <div class="chart-container">
                        <div class="bar-chart" id="strongChart"></div>
                    </div>
                </div>
            </div>

            <div class="pattern-analysis">
                <div class="pattern-title">🔍 ניתוח דפוסים מתקדם</div>
                <div class="pattern-grid">
                    <div class="pattern-card">
                        <div class="pattern-value" id="evenOddRatio">-</div>
                        <div class="pattern-label">יחס זוגי/אי-זוגי ממוצע</div>
                    </div>
                    <div class="pattern-card">
                        <div class="pattern-value" id="highLowRatio">-</div>
                        <div class="pattern-label">יחס גבוה/נמוך ממוצע</div>
                    </div>
                    <div class="pattern-card">
                        <div class="pattern-value" id="consecutiveAvg">-</div>
                        <div class="pattern-label">ממוצע מספרים רצופים</div>
                    </div>
                    <div class="pattern-card">
                        <div class="pattern-value" id="sumAverage">-</div>
                        <div class="pattern-label">ממוצע סכום הגרלה</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stats-card regular-numbers">
                    <div class="card-title">🔥 מספרים רגילים חמים (1-37)</div>
                    <div id="regularNumbersGrid" class="numbers-grid">
                        <!-- יוצג כאן דינמית -->
                    </div>
                </div>
                
                <div class="stats-card strong-numbers">
                    <div class="card-title">💪 מספרים חזקים (1-7)</div>
                    <div id="strongNumbersGrid" class="numbers-grid">
                        <!-- יוצג כאן דינמית -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let allResults = [];
        let regularStats = {};
        let strongStats = {};

        // טעינת הנתונים וחישוב הסטטיסטיקות
        async function loadAndCalculateStats() {
            try {
                const response = await fetch('Lotto.xlsx');
                if (!response.ok) throw new Error('לא ניתן לטעון את קובץ הנתונים');
                
                const data = await response.arrayBuffer();
                const workbook = XLSX.read(data, {type: 'array'});
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                allResults = jsonData;
                calculateStatistics();
                calculateCombinations();
                displayStatistics();
                
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('statsContent').style.display = 'block';
                
            } catch (error) {
                console.error('שגיאה בטעינת הנתונים:', error);
                document.getElementById('loadingMessage').innerHTML = '❌ שגיאה בטעינת הנתונים. אנא ודא שקובץ Lotto.xlsx קיים.';
            }
        }

        // חישוב הסטטיסטיקות
        function calculateStatistics() {
            // איפוס המונים
            regularStats = {};
            strongStats = {};
            
            // אתחול מספרים רגילים (1-37)
            for (let i = 1; i <= 37; i++) {
                regularStats[i] = 0;
            }
            
            // אתחול מספרים חזקים (1-7)
            for (let i = 1; i <= 7; i++) {
                strongStats[i] = 0;
            }
            
            // ספירת המספרים בכל הגרלה
            allResults.forEach(result => {
                // ספירת מספרים רגילים
                for (let i = 1; i <= 6; i++) {
                    const num = parseInt(result[i.toString()] || result[String.fromCharCode(65 + i)]);
                    if (num && num >= 1 && num <= 37) {
                        regularStats[num]++;
                    }
                }
                
                // ספירת מספר חזק
                const strongNum = parseInt(result['המספר החזק'] || result['7'] || result['H']);
                if (strongNum && strongNum >= 1 && strongNum <= 7) {
                    strongStats[strongNum]++;
                }
            });
        }

        
        // חישוב צירופים נפוצים
        function calculateCombinations() {
            pairStats = {};
            tripleStats = {};
            quadStats = {};

            allResults.forEach(result => {
                const numbers = [];
                
                // איסוף המספרים מההגרלה - נסה את כל האפשרויות
                for (let i = 1; i <= 6; i++) {
                    let num = result[i.toString()] || // '1', '2', '3', etc.
                             result[String.fromCharCode(65 + i)] || // 'B', 'C', 'D', etc.
                             result[`מספר ${i}`]; // 'מספר 1', 'מספר 2', etc.
                    
                    // בדיקה אם זה מחרוזת עם מספרים
                    if (typeof num === 'string') {
                        num = parseInt(num);
                    }
                    
                    if (num && !isNaN(num) && num >= 1 && num <= 37) {
                        numbers.push(num);
                    }
                }
                
                // רק אם יש לנו בדיוק 6 מספרים
                if (numbers.length === 6) {
                    numbers.sort((a, b) => a - b);
                    
                    // חישוב זוגות
                    for (let i = 0; i < numbers.length; i++) {
                        for (let j = i + 1; j < numbers.length; j++) {
                            const pair = `${numbers[i]}-${numbers[j]}`;
                            pairStats[pair] = (pairStats[pair] || 0) + 1;
                        }
                    }
                    
                    // חישוב שלשות
                    for (let i = 0; i < numbers.length; i++) {
                        for (let j = i + 1; j < numbers.length; j++) {
                            for (let k = j + 1; k < numbers.length; k++) {
                                const triple = `${numbers[i]}-${numbers[j]}-${numbers[k]}`;
                                tripleStats[triple] = (tripleStats[triple] || 0) + 1;
                            }
                        }
                    }
                    
                    // חישוב רביעיות
                    for (let i = 0; i < numbers.length; i++) {
                        for (let j = i + 1; j < numbers.length; j++) {
                            for (let k = j + 1; k < numbers.length; k++) {
                                for (let l = k + 1; l < numbers.length; l++) {
                                    const quad = `${numbers[i]}-${numbers[j]}-${numbers[k]}-${numbers[l]}`;
                                    quadStats[quad] = (quadStats[quad] || 0) + 1;
                                }
                            }
                        }
                    }
                }
            });
            
            // הוספת debug info
            console.log('Total pairs found:', Object.keys(pairStats).length);
            console.log('Top 3 pairs:', Object.entries(pairStats).sort((a,b) => b[1] - a[1]).slice(0,3));
        }            


        // הצגת הסטטיסטיקות
        function displayStatistics() {
            displaySummary();
            displayInsights();
            displayCharts();
            displayPatternAnalysis();
            displayRegularNumbers();
            displayStrongNumbers();
        }


        
        // הצגת הסיכום הכללי
        function displaySummary() {
            document.getElementById('totalDraws').textContent = allResults.length;
            
            // מציאת המספר הכי חם והכי קר
            const sortedRegular = Object.entries(regularStats).sort((a, b) => b[1] - a[1]);
            const sortedStrong = Object.entries(strongStats).sort((a, b) => b[1] - a[1]);
            
            document.getElementById('hottestNumber').textContent = sortedRegular[0][0];
            document.getElementById('coldestNumber').textContent = sortedRegular[sortedRegular.length - 1][0];
            document.getElementById('hottestStrong').textContent = sortedStrong[0][0];
        }


                // הצגת תובנות וצירופים
        function displayInsights() {
            // הצגת זוגות נפוצים
            const topPairs = Object.entries(pairStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const pairsContainer = document.getElementById('popularPairs');
            pairsContainer.innerHTML = topPairs.map(([pair, count]) => 
                `<div class="combination-item">
                    <span class="combination-numbers">${pair.replace('-', ', ')}</span>
                    <span class="combination-count">${count} פעמים</span>
                </div>`
            ).join('');

            // הצגת שלשות נפוצות
            const topTriples = Object.entries(tripleStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const triplesContainer = document.getElementById('popularTriples');
            triplesContainer.innerHTML = topTriples.map(([triple, count]) => 
                `<div class="combination-item">
                    <span class="combination-numbers">${triple.replace(/-/g, ', ')}</span>
                    <span class="combination-count">${count} פעמים</span>
                </div>`
            ).join('');

            // הצגת רביעיות נפוצות
            const topQuads = Object.entries(quadStats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 15);
            
            const quadsContainer = document.getElementById('popularQuads');
            quadsContainer.innerHTML = topQuads.map(([quad, count]) => 
                `<div class="combination-item">
                    <span class="combination-numbers">${quad.replace(/-/g, ', ')}</span>
                    <span class="combination-count">${count} פעמים</span>
                </div>`
            ).join('');
        }

        // הצגת גרפים
        function displayCharts() {
            // גרף מספרים רגילים
            const regularChart = document.getElementById('regularChart');
            const sortedRegular = Object.entries(regularStats).sort((a, b) => b[1] - a[1]);
            const maxRegular = sortedRegular[0][1];
            
            regularChart.innerHTML = sortedRegular.slice(0, 15).map(([number, count]) => {
                const height = (count / maxRegular) * 200;
                return `<div class="chart-bar" style="height: ${height}px;">
                    <div class="chart-bar-label">${number}</div>
                    <div class="chart-bar-value">${count}</div>
                </div>`;
            }).join('');

            // גרף מספרים חזקים
            const strongChart = document.getElementById('strongChart');
            const sortedStrong = Object.entries(strongStats).sort((a, b) => b[1] - a[1]);
            const maxStrong = sortedStrong[0][1];
            
            strongChart.innerHTML = sortedStrong.map(([number, count]) => {
                const height = (count / maxStrong) * 200;
                return `<div class="chart-bar" style="height: ${height}px; background: linear-gradient(to top, #ff6b6b, #ff8a80);">
                    <div class="chart-bar-label">${number}</div>
                    <div class="chart-bar-value">${count}</div>
                </div>`;
            }).join('');
        }

        // ניתוח דפוסים מתקדם
        function displayPatternAnalysis() {
            let evenCount = 0, oddCount = 0;
            let highCount = 0, lowCount = 0; // גבוה > 18, נמוך <= 18
            let consecutiveCount = 0;
            let totalSum = 0;
            let validDraws = 0;
            
            allResults.forEach(result => {
                const numbers = [];
                let drawSum = 0;
                
                for (let i = 1; i <= 6; i++) {
                    let num = result[i.toString()] || 
                             result[String.fromCharCode(65 + i)] || 
                             result[`מספר ${i}`];
                    
                    if (typeof num === 'string') {
                        num = parseInt(num);
                    }
                    
                    if (num && !isNaN(num) && num >= 1 && num <= 37) {
                        numbers.push(num);
                        drawSum += num;
                        
                        if (num % 2 === 0) evenCount++;
                        else oddCount++;
                        
                        if (num > 18) highCount++;
                        else lowCount++;
                    }
                }
                
                if (numbers.length === 6) {
                    totalSum += drawSum;
                    validDraws++;
                    
                    // בדיקת מספרים רצופים
                    numbers.sort((a, b) => a - b);
                    for (let i = 0; i < numbers.length - 1; i++) {
                        if (numbers[i + 1] - numbers[i] === 1) {
                            consecutiveCount++;
                        }
                    }
                }
            });
            
            if (validDraws > 0) {
                const totalNumbers = evenCount + oddCount;
                const evenOddRatio = `${Math.round((evenCount / totalNumbers) * 100)}:${Math.round((oddCount / totalNumbers) * 100)}`;
                const highLowRatio = `${Math.round((highCount / totalNumbers) * 100)}:${Math.round((lowCount / totalNumbers) * 100)}`;
                const avgConsecutive = (consecutiveCount / validDraws).toFixed(1);
                const avgSum = Math.round(totalSum / validDraws);
                
                document.getElementById('evenOddRatio').textContent = evenOddRatio;
                document.getElementById('highLowRatio').textContent = highLowRatio;
                document.getElementById('consecutiveAvg').textContent = avgConsecutive;
                document.getElementById('sumAverage').textContent = avgSum;
            } else {
                // אם אין נתונים תקינים
                document.getElementById('evenOddRatio').textContent = 'N/A';
                document.getElementById('highLowRatio').textContent = 'N/A';
                document.getElementById('consecutiveAvg').textContent = 'N/A';
                document.getElementById('sumAverage').textContent = 'N/A';
            }
            
            console.log('Pattern analysis - Valid draws:', validDraws);
            console.log('Even/Odd counts:', evenCount, oddCount);
        }

        // הצגת מספרים רגילים
        function displayRegularNumbers() {
            const container = document.getElementById('regularNumbersGrid');
            container.innerHTML = '';
            
            // מיון לפי תכיפות (מהגבוה לנמוך)
            const sorted = Object.entries(regularStats).sort((a, b) => b[1] - a[1]);
            const maxCount = sorted[0][1];
            
            sorted.forEach(([number, count], index) => {
                const item = document.createElement('div');
                item.className = 'number-item';
                
                // הוספת תווית חם/קר
                let label = '';
                if (index < 6) {
                    label = '<div class="hot-label">🔥 חם</div>';
                } else if (index >= sorted.length - 6) {
                    label = '<div class="cold-label">🧊 קר</div>';
                }
                
                const percentage = Math.round((count / maxCount) * 100);
                
                item.innerHTML = `
                    ${label}
                    <div class="number-value">${number}</div>
                    <div class="number-count">${count} פעמים</div>
                    <div class="frequency-bar">
                        <div class="frequency-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // הצגת מספרים חזקים
        function displayStrongNumbers() {
            const container = document.getElementById('strongNumbersGrid');
            container.innerHTML = '';
            
            // מיון לפי תכיפות (מהגבוה לנמוך)
            const sorted = Object.entries(strongStats).sort((a, b) => b[1] - a[1]);
            const maxCount = sorted[0][1];
            
            sorted.forEach(([number, count], index) => {
                const item = document.createElement('div');
                item.className = 'number-item';
                
                // הוספת תווית חם/קר
                let label = '';
                if (index < 2) {
                    label = '<div class="hot-label">🔥 חם</div>';
                } else if (index >= sorted.length - 2) {
                    label = '<div class="cold-label">🧊 קר</div>';
                }
                
                const percentage = Math.round((count / maxCount) * 100);
                
                item.innerHTML = `
                    ${label}
                    <div class="number-value">${number}</div>
                    <div class="number-count">${count} פעמים</div>
                    <div class="frequency-bar">
                        <div class="frequency-fill" style="width: ${percentage}%"></div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        // פורמט תאריך
        function formatDate(dateValue) {
            if (!dateValue) return '';
            
            if (typeof dateValue === 'number') {
                const date = XLSX.SSF.parse_date_code(dateValue);
                return `${date.d.toString().padStart(2, '0')}/${date.m.toString().padStart(2, '0')}/${date.y}`;
            }
            
            return dateValue.toString();
        }

        // טעינה כשהדף נטען
        window.addEventListener('load', loadAndCalculateStats);
    </script>
</body>
</html>
